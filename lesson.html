<!DOCTYPE html>
<html>
<head>
  <title>Lesson Detail</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 20px; }
    h1 { font-size: 24px; margin-bottom: 20px; }
    .tabs { display: flex; gap: 20px; margin-bottom: 20px; }
    .tabs button { padding: 10px 20px; border: none; background: #eee; cursor: pointer; }
    .tabs button.active { background: purple; color: #fff; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .item {
      background: #fff;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
      box-shadow: 0 0 6px rgba(0,0,0,0.1);
    }
    .item img {
      max-width: 100%;
      height: auto;
      margin-bottom: 10px;
    }
    .btns a {
      display: inline-block;
      margin-right: 10px;
      padding: 8px 12px;
      background: #007bff;
      color: #fff;
      text-decoration: none;
      border-radius: 4px;
    }
    .btns a.disabled {
      background: gray;
      pointer-events: none;
    }
  </style>
</head>
<body>

<h1 id="lessonTitle">Loading Lesson...</h1>

<div class="tabs">
  <button class="tab-btn active" data-tab="videos">Videos</button>
  <button class="tab-btn" data-tab="notes">Notes</button>
</div>

<div id="videos" class="tab-content active"></div>
<div id="notes" class="tab-content"></div>

<script>
  const urlParams = new URLSearchParams(window.location.search);
  const courseId = urlParams.get('courseId');
  const lessonId = urlParams.get('lessonId');

  const videoContainer = document.getElementById('videos');
  const notesContainer = document.getElementById('notes');
  const titleEl = document.getElementById('lessonTitle');

  fetch(`https://api.khanglobalstudies.com/cms/courses/${courseId}/lessons/${lessonId}`)
    .then(res => res.json())
    .then(data => {
      titleEl.textContent = data.name || "Lesson";

      data.videos.forEach(video => {
        const ytId = extractYouTubeId(video.video_url) || extractYouTubeId(video.thumb);
        const youtubeUrl = ytId ? `https://www.youtube.com/watch?v=${ytId}` : null;
        const kgsUrl = `https://khanglobalstudies.com/player?vvid=${video.id}`;

        const thumbImg = video.thumb
          ? `<img src="${video.thumb}" alt="Thumb">`
          : `<div style="height:100px;background:#ccc;text-align:center;line-height:100px;">No Thumbnail</div>`;

        const html = `
          <div class="item">
            ${thumbImg}
            <h3>${video.name}</h3>
            <div class="btns">
              <a href="${kgsUrl}" target="_blank">KGS</a>
              ${youtubeUrl
                ? `<a href="${youtubeUrl}" target="_blank">YouTube</a>`
                : `<a class="disabled">YouTube</a>`}
            </div>
          </div>
        `;

        if (video.type === 'pdf') {
          notesContainer.innerHTML += html;
        } else {
          videoContainer.innerHTML += html;
        }
      });
    });

  function extractYouTubeId(input) {
    if (!input) return null;
    const ytRegex = /(?:youtube\.com\/(?:embed\/|watch\?v=)|youtu\.be\/|vi\/|\/v\/|\/e\/|watch\?.+&v=)([a-zA-Z0-9_-]{11})|i\.ytimg\.com\/vi\/([a-zA-Z0-9_-]{11})/;
    const match = input.match(ytRegex);
    return match ? (match[1] || match[2]) : null;
  }

  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById(btn.dataset.tab).classList.add('active');
    });
  });
</script>

</body>
</html>
